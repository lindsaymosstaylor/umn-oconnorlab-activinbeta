---
title: "ActivinBeta Analysis and Figure Generation"
output: html_document
---

---
title: "Analysis and Figure Generation Code"
output: html_document
---
#Source: https://github.com/lindsaymosstaylor/umn-oconnorlab-activinbeta
#loadpackages
```{r,echo=FALSE}
library(plyr)
library(reshape2)
library(gridExtra)
library(scales)
library(ggplot2)
library(magrittr)
library(DBI)
library(tidyr)
library(tidyverse)
library(dichromat)
library(viridis)
library(vioplot)  
```


#setup functions to use throughout the code
```{r}
#functions to prep size measurement data 
#function to prep data for volume measurement, calculated assuming prolate spheroid geometry
readysize<-function(x){
   result<-  mutate(x,lengthmm=length*5.509641873/1000) %>% #calc length in mm
    mutate( widthmm=width*5.509641873/1000) %>% #calc width in mm
    mutate(volume=  0.524*(widthmm^2)*lengthmm) %>% #calc vol in mm
    subset(select=c(geno,rep,volume)) %>% #subset just needed data
 gather('volume',key="measurement",value="value") #"volume" can be changed to match data label as imported
   result["date"]<-"NA"
return(result)
}
#function to prep data for length measurement
# readysizeL<-function(x){
#    result<-  mutate(x,lengthmm=length*5.509641873/1000) %>% #calc length in mm
#     mutate( widthmm=width*5.509641873/1000) %>% #calc width in mm
#     mutate(volume=  0.524*(widthmm^2)*lengthmm) %>% #calc vol in mm
#     subset(select=c(geno,rep,lengthmm)) %>% #subset just needed data
#  gather('lengthmm',key="measurement",value="value")
#    result["date"]<-"NA"
# return(result)
# }
# 
# #function to prep data for width measurement
# readysizeW<-function(x){
#    result<-  mutate(x,lengthmm=length*5.509641873/1000) %>% #calc length in mm
#     mutate( widthmm=width*5.509641873/1000) %>% #calc width in mm
#     mutate(volume=  0.524*(widthmm^2)*lengthmm) %>% #calc vol in mm
#     subset(select=c(geno,rep,widthmm)) %>% #subset just needed data
#  gather('widthmm',key="measurement",value="value")
#    result["date"]<-"NA"
# return(result)
# }

#function to prep viability data
readyviabililty<-function(x){
  result<- mutate(x,viability=adults/larvae*100) %>%
    subset(select=c(geno,rep,viability)) %>%
     gather('viability',key="measurement",value="value")
   result["date"]<-"NA"
return(result)
  }

#function to prep timing data
readytiming<-function(x){
  result<- gather(x,'halfpoint',key="measurement",value="value")
return(result)
}

#function to prep data for adult length measurement
readysizeAdultLength<-function(x){
   result<-    mutate(x,lengthmm=length*5.509641873/1000) %>% #calc length in mm
    subset(select=c(geno,rep,lengthmm)) %>% #subset just needed data
 gather('lengthmm',key="measurement",value="value")
   result["date"]<-"NA"
return(result)
}

#bind all three df (measurements) together and prep data
#ex "II" and "G" are aspects of genotype/conditions
tidyall<-function(x){
   x["driver"]<-c(drivername) #create col name driver filled with driver data
 
   x$geno<-gsub('II','G',x$geno)
   x$geno<-gsub('MN','G',x$geno)
  x$geno<-gsub('NE','G',x$geno)
  x$geno<-gsub('N','G',x$geno)
  x$geno<-gsub('D','G',x$geno)
  x$geno<-gsub('R','G',x$geno)
   x$geno<-gsub('M','G',x$geno)
    x$geno<-gsub('L','G',x$geno)
   x$geno<-gsub('TG','T',x$geno)
   
   #x$geno<-factor(x$geno,levels=c("W","U","G","T")) #set as factor,reorder factors
   x$geno<-factor(x$geno,levels=c("U","G","T","W")) #set as factor,reorder factors #wild type on right
   x$measurement<-factor(x$measurement)
   #all$driver<-factor(all$driver,levels=drivers)
   result<-x
   return(result)
}

#similar to last function
mtidyall<-function(x){
   #x["driver"]<-c(drivername) #create col name driver filled with driver data
       x$geno<-gsub('MPDK','T',x$geno)
   x$geno<-gsub('MAKT','T',x$geno)
  x$geno<-gsub('MRHEB','T',x$geno)
   x$geno<-gsub('PDK','U',x$geno)
   x$geno<-gsub('AKT','U',x$geno)
  x$geno<-gsub('RHEB','U',x$geno)
    x$geno<-gsub('w1118','W',x$geno)

   #x$geno<-factor(x$geno,levels=c("W","U","G","T")) #set as factor,reorder factors
   x$geno<-factor(x$geno,levels=c("U","M","T","W")) #set as factor,reorder factors #wild type on right
   #x$measurement<-factor(x$measurement)
   #all$driver<-factor(all$driver,levels=drivers)
   result<-x
   return(result)
}

#set standard error
myFuncSE = function(x) {
result = c(mean(x) - sd(x)/sqrt(length(x)) , mean(x) + sd(x)/sqrt(length(x)))
names(result) = c("ymin", "ymax")
result
}
```

#set colors and shapes
```{r}
##set master color list
#colors and shapes are indexed here
#grey60 for controls
colormaster<-c(
  "gray60", #1
  "gray30", #2
  "mediumblue", #3
  "dodgerblue", #4
  "aquamarine4", #5
  "steelblue3", #6
  "thistle4",#7
  "dodgerblue4",#8
  "#FF6600", #9 orange
   "#9933CC", #10 purple
   "#99CC00")#11 green
rescuecolors<-c("red","dodgerblue","purple1",colormaster[1] )
actP80sizecolors<-c(colormaster[1],colormaster[4],colormaster[3],colormaster[4],colormaster[3],colormaster[3])
act80timingcolors<-c(colormaster[1],colormaster[4],colormaster[3]) 
actPtimingcolors<-c(colormaster[1],colormaster[3])
actctimingcolors<-c(colormaster[1],colormaster[9],colormaster[10],colormaster[11])
allcrisprallelescolors<-c(colormaster[1],colormaster[1],colormaster[3],colormaster[3],colormaster[3],colormaster[4],colormaster[4],colormaster[4])

#set shapes
shapemaster<-c(22, #1 square for wildtype
               24, #2 up triangle
               25, #3 down triangle
               23, #4 diamond
               21, #5 circle
               1, #6 outline circle 
               5, #7 outline diamond,
               2, #8 outline downtriangle
               6) #9 outline downtriangle

rescueshapes<-c(shapemaster[2],shapemaster[3],shapemaster[4],shapemaster[1])
actP80sizeshapes<-c(shapemaster[1],shapemaster[2],shapemaster[2],shapemaster[3],shapemaster[3],shapemaster[4])
timing80shapes<-c(shapemaster[1],shapemaster[2],shapemaster[2])
timingPshapes<-c(shapemaster[1],shapemaster[3])
act802shapes<-c(shapemaster[1],shapemaster[2])
crisprshapes<-c(shapemaster[1],shapemaster[4],shapemaster[4],shapemaster[4])
allcrisprallelesshapes<-c(shapemaster[1],shapemaster[1],shapemaster[4],shapemaster[4],shapemaster[4],shapemaster[4],shapemaster[4],shapemaster[4])
GAL4shapes<-c(shapemaster[2],shapemaster[3],shapemaster[4])
```

#function to import size, timing, viability and deals with data, creates sizesum (df of summary) and bindall (df of all data) by individual driver
```{r}
#function to import each type of data together by a key
driverdata<-function(x,y,z){
#import each file, having set the location previously
size<-read.csv(x,stringsAsFactors=FALSE) #import, remove factors, location of document set externally
timing<-read.csv(y,stringsAsFactors=FALSE) #import, remove factors, location of document set externally
viability<-read.csv(z,stringsAsFactors=FALSE) #import, remove factors, location of document set externally

#prep the data, makes calculations and bind together
rsize<-readysize(size)
rtim<-readytiming(timing)
rvia<-readyviabililty(viability)
bindall <-rbind(rsize,rtim,rvia)
bindall<-tidyall(bindall)#cleans up and reorders factors
 
#preps data after bound together
#bindall$geno<-factor(bindall$geno,levels=c("W","U","G","T")) #set genotypes as level in right order
bindall$geno<-factor(bindall$geno,levels=c("U","G","T","W")) #set genotypes as level in right order #wild-type on right
bindall$measurement<-as.factor(bindall$measurement) #set measurements as factors
bindall$rep<-as.factor(bindall$rep) #set replicates as factors
bindall$driver<-as.factor(bindall$driver) #set driver AS FACTOR
bindall$date<-as.factor(bindall$date) #set date as factor
result<-bindall
return(result)
}
```


#summary generator for one driver
```{r}
#summarize data to check 
#SIZE summary, generates summary for size data
sumgenONE<-function(x){
 size<-subset(x,measurement=="volume") #subsets just size data from all data
timing<-subset(x,measurement=="halfpoint") #subsets just timing data from all data
viability<-subset(x,measurement=="viability") #subsets just viability data from all data
sizesum<-ddply(size, c("geno"),summarise,
               N=length(value),
      mean=mean(value,na.rm=T)
      )
sizesum["measurement"]<-c("size")

#TIMING summary, generates summary for timing data
timingsum<-ddply(timing, c("geno"),summarise,
               N=length(value),
      mean=mean(value,na.rm=T)
      )
timingsum["measurement"]<-c("timing")

#VIABILITY summary, generates summary for viability data
viabilitysum<-ddply(viability, c("geno"),summarise,
               N=length(value),
      mean=mean(value,na.rm=T)
      )
viabilitysum["measurement"]<-c("viability")

#cant use nlevels() in ddply summarize, so do manually
sizereps<-length(unique(size$rep))
timingreps<-length(unique(timing$rep))
viabilityreps<-length(unique(viability$rep))

sizesum["reps"]<-sizereps
timingsum["reps"]<-timingreps
viabilitysum["reps"]<-viabilityreps

#cant use nlevels() in ddply summarize, so do manually
sizedate<-length(unique(size$date))
timingdate<-length(unique(timing$date))
viabilitydate<-length(unique(viability$date))

sizesum["date"]<-sizedate
timingsum["date"]<-timingdate
viabilitysum["date"]<-viabilitydate

sumnew<-rbind(sizesum,timingsum,viabilitysum) #bind three summaries
sumnew["driver"]<-c(drivername) #create new column named driver filled with driver name
sumnew$driver<-as.factor(sumnew$driver)
sumnew$measurement<-as.factor(sumnew$measurement)
result<-sumnew[c("driver","measurement","geno","date","N","mean")] #reorders columns #"reps",
return(result)
}


```

```{r}
#summary generator for one driver
#summarize data to check 
#SIZE summary

sumgenONEjustsize<-function(x){
 size<-subset(x,measurement=="volume") #subsets just size data from all data
 timing<-subset(x,measurement=="halfpoint") #subsets just timing data from all data
 viability<-subset(x,measurement=="viability") #subsets just viability data from all data
sizesum<-ddply(size, c("geno"),summarise,
               N=length(value),
      mean=mean(value,na.rm=T)
      )
sizesum["measurement"]<-c("size")

 #TIMING summary
 timingsum<-ddply(timing, c("geno"),summarise,
               N=length(value),
       mean=mean(value,na.rm=T)
       )
 timingsum["measurement"]<-c("timing")

 #VIABILITY summary
 viabilitysum<-ddply(viability, c("geno"),summarise,
                N=length(value),
      mean=mean(value,na.rm=T)
       )
 viabilitysum["measurement"]<-c("viability")

#cant use nlevels() in ddply summarize, so do manually
 sizereps<-length(unique(size$rep))
 timingreps<-length(unique(timing$rep))
 viabilityreps<-length(unique(viability$rep))

 sizesum["reps"]<-sizereps
 timingsum["reps"]<-timingreps
 viabilitysum["reps"]<-viabilityreps

#cant use nlevels() in ddply summarize, so do manually
sizerep<-length(unique(size$rep))
# timingdate<-length(unique(timing$date))
# viabilitydate<-length(unique(viability$date))

sizesum["rep"]<-sizerep
# timingsum["date"]<-timingdate
# viabilitysum["date"]<-viabilitydate

sumnew<-rbind(sizesum) #bind three summaries   ,timingsum,viabilitysum
#sumnew["var"]<-c(var) #create new column named driver filled with driver name
#sumnew$var<-as.factor(sumnew$var)
sumnew$measurement<-as.factor(sumnew$measurement)
result<-sumnew[c("measurement","geno","N","mean")] #reorders columns #"reps","var"
return(result)
}


sumgenONEsize<-function(x){
 size<-subset(x,measurement=="volume") #subsets just size data from all data
sizesum<-ddply(size, c("geno"),summarise,
               N=length(value),
      mean=mean(value,na.rm=T)
      )
sizesum["measurement"]<-c("size")
#cant use nlevels() in ddply summarize, so do manually
# sizereps<-length(unique(size$rep))
# timingreps<-length(unique(timing$rep))
# viabilityreps<-length(unique(viability$rep))
# 
# sizesum["reps"]<-sizereps
# timingsum["reps"]<-timingreps
# viabilitysum["reps"]<-viabilityreps

#cant use nlevels() in ddply summarize, so do manually
sizerep<-length(unique(size$rep))
sizesum["rep"]<-sizerep
# timingsum["date"]<-timingdate
# viabilitysum["date"]<-viabilitydate

sumnew<-rbind(sizesum) #bind three summaries   ,timingsum,viabilitysum
#sumnew["var"]<-c(var) #create new column named driver filled with driver name
#sumnew$var<-as.factor(sumnew$var)
sumnew$measurement<-as.factor(sumnew$measurement)
result<-sumnew[c("measurement","geno","N","mean")] #reorders columns #"reps","var"
return(result)
}


sumgenONElength<-function(x){
 size<-subset(x,measurement=="lengthmm") #subsets just size data from all data
sizesum<-ddply(size, c("geno"),summarise,
               N=length(value),
      mean=mean(value,na.rm=T)
      )
sizesum["measurement"]<-c("size")
#cant use nlevels() in ddply summarize, so do manually
# sizereps<-length(unique(size$rep))
# timingreps<-length(unique(timing$rep))
# viabilityreps<-length(unique(viability$rep))
# 
# sizesum["reps"]<-sizereps
# timingsum["reps"]<-timingreps
# viabilitysum["reps"]<-viabilityreps

#cant use nlevels() in ddply summarize, so do manually
sizerep<-length(unique(size$rep))
sizesum["rep"]<-sizerep
# timingsum["date"]<-timingdate
# viabilitysum["date"]<-viabilitydate

sumnew<-rbind(sizesum) #bind three summaries   ,timingsum,viabilitysum
#sumnew["var"]<-c(var) #create new column named driver filled with driver name
#sumnew$var<-as.factor(sumnew$var)
sumnew$measurement<-as.factor(sumnew$measurement)
result<-sumnew[c("measurement","geno","N","mean")] #reorders columns #"reps","var"
return(result)
}

sumgenONEwidth<-function(x){
 size<-subset(x,measurement=="widthmm") #subsets just size data from all data
sizesum<-ddply(size, c("geno"),summarise,
               N=length(value),
      mean=mean(value,na.rm=T)
      )
sizesum["measurement"]<-c("size")
#cant use nlevels() in ddply summarize, so do manually
# sizereps<-length(unique(size$rep))
# timingreps<-length(unique(timing$rep))
# viabilityreps<-length(unique(viability$rep))
# 
# sizesum["reps"]<-sizereps
# timingsum["reps"]<-timingreps
# viabilitysum["reps"]<-viabilityreps

#cant use nlevels() in ddply summarize, so do manually
sizerep<-length(unique(size$rep))
sizesum["rep"]<-sizerep
# timingsum["date"]<-timingdate
# viabilitysum["date"]<-viabilitydate

sumnew<-rbind(sizesum) #bind three summaries   ,timingsum,viabilitysum
#sumnew["var"]<-c(var) #create new column named driver filled with driver name
#sumnew$var<-as.factor(sumnew$var)
sumnew$measurement<-as.factor(sumnew$measurement)
result<-sumnew[c("measurement","geno","N","mean")] #reorders columns #"reps","var"
return(result)
}
```


#function to run Tukey's HSD and output to an object
```{r}
#input to function is output from TukeyHSD, default comparison is first
TukOut<-function(x,comp=1){
  lists<-x[[comp]]
  dd<-as.vector(matrix(unlist(lists), nrow=length(unlist(lists[1])))) #extract all numbers in a vector
  dn<-unlist(attr(lists, "dimnames")) #extract all dimension names
  #homemade output dataframe for statistics
  #can work with any length of comparisons
  diff<- dd[1:(length(dd)/4)] #1:28 
  lwr<-dd[(length(dd)/4 +1) : (length(dd)/4 *2)]
  upr<-dd[(length(dd)/4 *2 +1) : (length(dd)/4 *3)]
  padj<-dd[(length(dd)/4 *3 +1) : (length(dd)/4 *4)]
  comparision<-dn[1:(length(dn)-4)] #pairwise comparisons length(dn)-4
  Tukey<-cbind(comparision,diff,lwr,upr,padj)
  result<-as.data.frame(Tukey)
  return(result)
}
#TukOut(stats,2) #example
```

#bind all stats to df
```{r}
statbindall<-function(x){
s<-subset(x, measurement=="volume" )
t<-subset(x, measurement=="halfpoint" )
v<-subset(x, measurement=="viability" )
s_stats<-TukeyHSD(aov(s$value~s$geno))
t_stats<-TukeyHSD(aov(t$value~t$geno+t$date))
v_stats<-TukeyHSD(aov(v$value~v$geno))
size<-TukOut(s_stats)
timing<-TukOut(t_stats)
viability<-TukOut(v_stats)
size["measurement"]<-"size"
timing["measurement"]<-"halfpoint"
viability["measurement"]<-"viability"
result<-rbind(size,timing,viability)
return(result)
}

#statFun()
statFun<-function(x){
stats<-TukeyHSD(aov(x$value~x$geno))
result<-TukOut(stats)
result<-result[c("comparision","padj","diff","lwr","upr")]
return(result)
}

#statFundate
statFunDate<-function(x){
stats<-TukeyHSD(aov(x$value~x$geno+x$date))
result<-TukOut(stats)
result<-result[c("comparision","padj","diff","lwr","upr")]
return(result)
}


#statFunrep
statFunRep<-function(x){
stats<-TukeyHSD(aov(x$value~x$geno+x$rep))
result<-TukOut(stats)
result<-result[c("comparision","padj","diff","lwr","upr")]
return(result)
}

sumFun<-function(x){
result<-ddply(x, c("geno"),summarise,
               N=length(value),
      mean=mean(value,na.rm=T)
      )
reps<-length(unique(x$rep))
result["reps"]<-reps
dates<-length(unique(x$date))
result["date"]<-dates
return(result)
}
```

```{r}
#set graph without facet
#graph functions divided into two functions: basePlot and restofPlot
#graph data without an outline around points

#main parts of plots coded here
basePlot<-function(x,sizing=3,jitterwidth=0.35) {
  result <- ggplot(x, aes(x=geno, y=value))+ geom_point(aes(fill=geno,shape=geno,stroke=0),size=sizing,colour="black",
position=position_jitter(width=jitterwidth,height=0))
  return(result)
}


#draw the rest of the owl
#set features for the rest of the graph
restofPlot<-function(x,statdiamondsize=2,colorset=colormaster,shapesset=shapemaster,axistextcolor="azure4",legendposition="bottom",errorbarwidth=0.7,errorbarsize=1)
{

  plot <- x + theme(strip.text.x = element_text(size=22,colour="black",angle=0),strip.background=element_rect(colour="white",fill="white",size=1))
plot <-plot + theme(panel.background=element_rect(colour="white", fill="white",size=2))
plot<- plot +theme(panel.grid.minor=element_line(colour="gray"),panel.grid.major=element_line(colour="gray"),panel.grid.major.x =  element_line(colour =  "gray80"),axis.ticks.y = element_line(colour="gray"))
plot <- plot + scale_shape_manual(values=shapesset,name="Genotype")
plot <- plot + scale_fill_manual(values=colorset,name="Genotype")
#plot <- plot + ggtitle(drivername)
plot <- plot + theme(plot.title = element_text(size=10))
#plot <- plot + guides(fill=TRUE) + guides(shape=TRUE)
#plot <- plot + guides(fill=FALSE) + guides(shape=FALSE)
plot <- plot + labs(x="",y="")
plot <- plot + scale_x_discrete(labels=NULL)
#plot <- plot + scale_size_discrete(solid=T, legend=F)
plot <- plot + theme(axis.text.y=element_text(size=15,colour = "grey62"))+theme(axis.ticks=element_line(colour="gray"))
plot <- plot + stat_summary(fun.data="myFuncSE",geom="errorbar",width=errorbarwidth,size=errorbarsize)
plot <- plot + stat_summary(fun.y=mean,geom="point",shape=23,size=statdiamondsize+0.05,fill="black")
plot <- plot + stat_summary(fun.y=mean,geom="point",shape=23,size=statdiamondsize,fill="gold")
result<-plot  + theme(axis.text.x=element_blank()) +
 theme(legend.text=element_text(size=20), #if using guide
           legend.title=element_text(size=10),
            legend.key.size = unit(1.5, "cm"),
           legend.key=element_rect(fill="white"),legend.direction="vertical") + guides(shape=guide_legend(override.aes=list(size=10,fill=colorset))) +theme(legend.position=legendposition)
return(result)
}

```

#ligand rescues:import data
```{r}
#start of ligand rescues
#file locations
#set for each driver

#ACTBETA GAL4
sTII<-"sizeTII.csv"
tTII<-"timingTII.csv"
vTII<-"viabilityTII.csv"

#OK371 MOTONEURON

sTMN<-"sizeTMN.csv"
tTMN<-"timingTMN.csv"
vTMN<-"viabilityTMN.csv" 

#C929 NEUROENDOCRINE

sTN<-"sizeTN.csv"
tTN<-"timingTN.csv"
vTN<-"viabilityTN.csv" 

#dilp2 IPCs

sTD<-"sizeTD.csv"
tTD<-"timingTD.csv"
vTD<-"viabilityTD.csv" 

#C929 NEUROENDOCRINE

sTR<-"sizeTR.csv"
tTR<-"timingTR.csv"
vTR<-"viabilityTR.csv" 

#PPL fat body

sTL<-"sizeTL.csv"
tTL<-"timingTL.csv"
vTL<-"viabilityTL.csv" 

#MHC fabio, skeletal muscle

sTM<-"sizeTM.csv"
tTM<-"timingTM.csv"
vTM<-"viabilityTM.csv" 


```

#ligand rescues: driverdata,sumgenONE,statbindall
```{r}
#run driverdata function, create summary df and bindall df
drivername<-c("TMN") #set drivername
bindallTMN<-driverdata(sTMN,tTMN,vTMN) #run function, save bindall df
sumTMN<-sumgenONE(bindallTMN)
statTMN<-statbindall(bindallTMN)
statTMN["driver"]<-"TMN" #runs stats on size, timing, and viability measurments (ALL three) and binds them together and labels them with driver name

drivername<-c("TII")
bindallTII<-driverdata(sTII,tTII,vTII)
sumTII<-sumgenONE(bindallTII)
statTII<-statbindall(bindallTII)
statTII["driver"]<-"TII"

drivername<-c("TN")
bindallTN<-driverdata(sTN,tTN,vTN)
sumTN<-sumgenONE(bindallTN)
statTN<-statbindall(bindallTN)
statTN["driver"]<-"TN"

drivername<-c("TD")
bindallTD<-driverdata(sTD,tTD,vTD)
sumTD<-sumgenONE(bindallTD)
statTD<-statbindall(bindallTD)
statTD["driver"]<-"TD"

drivername<-c("TR")
bindallTR<-driverdata(sTR,tTR,vTR)
sumTR<-sumgenONE(bindallTR)
statTR<-statbindall(bindallTR)
statTR["driver"]<-"TR"

drivername<-c("TL")
bindallTL<-driverdata(sTL,tTL,vTL)
sumTL<-sumgenONE(bindallTL)
statTL<-statbindall(bindallTL)
statTL["driver"]<-"TL"

drivername<-c("TM")
bindallTM<-driverdata(sTM,tTM,vTM)
sumTM<-sumgenONE(bindallTM)
statTM<-statbindall(bindallTM)
statTM["driver"]<-"TM"

#bindall summary  tables together
sumtabALL<-rbind(sumTMN,sumTII,sumTN,sumTD,sumTR,sumTL,sumTM)


#bind each driver stats together
alldriverstats<-rbind(statTII,statTMN,statTN,statTD,statTR,statTL,statTM) 
alldriverstats<-alldriverstats[c("driver","measurement", "comparision","padj","diff","lwr","upr")] #reorders columns
names(alldriverstats)[names(alldriverstats)=="comparision"]<-"comp"
justrelevantstats<-subset(alldriverstats,comp=="T-G" | comp=="T-U" | comp=="T-W")
timingstats<-alldriverstats %>% subset(comp=="T-G" | comp=="T-U" | comp=="T-W")  %>% subset(measurement=="halfpoint")
sizestats<-alldriverstats %>% subset(comp=="T-G" | comp=="T-U" | comp=="T-W")  %>% subset(measurement=="size")
viabilitystats<-alldriverstats %>% subset(comp=="T-G" | comp=="T-U" | comp=="T-W")  %>% subset(measurement=="viability")

```

#ligand rescues: bindall data together
```{r}
#bind all data together
dataALL<-rbind(bindallTII,bindallTR,bindallTMN,bindallTN,bindallTD,bindallTL,bindallTM) 
# dataALL<-rbind(bindallTa,bindallTII,bindallTMN,bindallTN,bindallTD,bindallTR,bindallTL,bindallTM, bindallTb) #spacer
str(dataALL)
dataALL$driver<-factor(dataALL$driver,levels=c("TII","TR","TMN","TN","TD","TL","TM"))#reorder factors to change order of graphs
```

#ligand rescues: export summary,stats
```{r}
write.csv(alldriverstats,"ActBeta_Rescues_alldriverstats.csv")
write.csv(justrelevantstats,"ActBeta_Rescues_justrelevantstats.csv")
write.csv(timingstats,"ActBeta_Rescues_timingstats.csv")
write.csv(sizestats,"ActBeta_Rescues_sizestats.csv")
write.csv(viabilitystats,"ActBeta_Rescues_viabilitystats.csv")
```

#ligand rescues: subset data to plot by measurement
```{r}
# #subset just the data by measurement to plot
justsize<-subset(dataALL,measurement=="volume") #subsets just size data from all data
justtiming<-subset(dataALL,measurement=="halfpoint") #subsets just timing data from all data
justviability<-subset(dataALL,measurement=="viability") #subsets just viability data from all data
# #sumtabALL<-sumgenALL(justsize,justtiming,justviability)
```

#PLOT rescue wraps colors what is this, another copy of baseplot function
```{r}
#set the number of drivers used for the plot to make rows
drivers<-levels(justsize$driver) #sets drivers present in all data
numdrivers<-length(drivers) #sets the number of drivers present in all data
xlabels="" 

justsize$driver<-factor(justsize$driver,levels=c("TII","TR","TMN","TN","TD","TL","TM"))
justtiming$driver<-factor(justtiming$driver,levels=c("TII","TR","TMN","TN","TD","TL","TM"))
justviability$driver<-factor(justviability$driver,levels=c("TII","TR","TMN","TN","TD","TL","TM"))

#basePlotA #with Alpha
basePlotA<-function(x,sizing=3,jitterwidth=0.35) {
  result <- ggplot(x, aes(x=geno, y=value))+ geom_point(aes(fill=geno,shape=geno,stroke=0,alpha=0.05),size=sizing,colour="black",
position=position_jitter(width=jitterwidth,height=0))
  return(result)
}

#baseplots labeller=labeller(sex = reverse)
sizeplot<-basePlotA(justsize,3) +facet_wrap(~driver,nrow=numdrivers)

timingplot<-basePlot(justtiming,3) +facet_wrap(~driver,nrow=numdrivers)
viabilityplot<-basePlot(justviability,5) +facet_wrap(~driver,nrow=numdrivers)

#start of wraps

gal4uascolset<-viridis(2, alpha = 1, begin=0.7, end =  .4, option = "D")

#actP80sizecolors<-c("gray60",justfirstone[1], actcolors[2:5])
rescuecolors<-c(  gal4uascolset  , actP80sizecolors[6], actP80sizecolors[1] )
GAL4UAScol<-c(gal4uascolset,actP80sizecolors[6])

greyset<-c("grey50","grey50","grey50","grey50")
greyshapes<-c(23,23,23,23)
#finishing touches
slim<-c(-2,8) #-1,6
sbr<-c(0,1,2,3,4)
slab<-c(0,1,2,3,4)
sizewrap<-restofPlot(sizeplot,3,legendposition = "none",colorset=greyset,shapesset=greyshapes,errorbarwidth =0.9,errorbarsize = 0.1)+scale_y_continuous(limits=slim,breaks=sbr,labels=slab)+theme(panel.grid.minor.y=element_blank())+ theme(strip.text.x = element_text(size = 8,colour="white"))
#sizewrap

#+scale_y_continuous(limits=slim,breaks=sbr,labels=slab)
tlim<-c(100,160)
tbr<-c(110,120,130,140)
tlab<-c(110,120,130,140)
timingwrap<-restofPlot(timingplot,2,legendposition = "none",colorset=greyset,shapesset=greyshapes,errorbarwidth =0.9,errorbarsize = 0.2)+scale_y_continuous(limits=tlim,breaks=tbr,labels=tlab)+theme(panel.grid.minor.y=element_blank())+ theme(strip.text.x = element_text(size = 8,colour="white"))

#+scale_y_continuous(limits=tlim,breaks=tbr,labels=tbr)

vlim<-c(-40,190)
vbr<-c(0,25,50,75,100)
vlab<-c(0,25,50,75,100)
viabilitywrap<-restofPlot(viabilityplot,4,legendposition = "none",colorset=greyset,shapesset=greyshapes,errorbarwidth =0.9,errorbarsize = 0.2)+scale_y_continuous(limits=vlim,breaks=vbr,labels=vlab)+ theme(axis.text.y=element_text(size=12,colour = "grey62"))+theme(panel.grid.minor.y=element_blank())+ theme(strip.text.x = element_text(size = 8,colour="white"))
```

```{r}
#apply to full plot for ligand rescues
driver<-c("TII","TR","TMN","TN","TD","TL","TM")

#pvalue annotation function
pval_anno<-function(driver,pval,breakx,valuey){
#driver is vector of facets #driver<-c("TII","TR","TMN","TN","TD","TL","TM") #v
#w is vector of pvals #pval<-c("ns", "ns", "ns","ns",  "ns", "****", "ns") #w
#x is single value vector of x axis break #breakx <-c(130) #x
#y is single value vector of y axis placement #valuey<-c(3) #y
df<-cbind(driver,pval)
df<-as.data.frame(df)
df$breaks<-rep(breakx,length(driver))
df$values<-rep(valuey,length(driver))
result<-df
return(result)
}


#ligand rescue size facet wrap pvalues
#dan's solution
driver<-c("TII","TR","TMN","TN","TD","TL","TM") #v
pval<-c("` ****`", "` ***`", "` ****`","` ***`",  "` `^ns", "` ****`", "` ****`") #w
breakx <-c(3.75) #x
valuey<-c(3) #y
#creates dataframe
sizepvalannodf<-pval_anno(driver,pval,breakx,valuey)


#ligand rescue timing facet wrap pvalues
driver<-c("TII","TR","TMN","TN","TD","TL","TM") #v
pval<-c("` `^ns", "` `^ns", "` `^ns","` `^ns",  "` `^ns", "` ****`", "` `^ns") #w
breakx <-c(133) #x
valuey<-c(3) #y
#creates dataframe
timingpvalannodf<-pval_anno(driver,pval,breakx,valuey)

#ligand rescue viability facet wrap pvalues
driver<-c("TII","TR","TMN","TN","TD","TL","TM") #v
pval<-c("` ***`", "` **`", "` ****`","` ****`",  "` `^ns", "` ***`", "` `^ns") #w
breakx <-c(100) #x
valuey<-c(3) #y
#creates dataframe
viapvalannodf<-pval_anno(driver,pval,breakx,valuey)
```

```{r}
#puts all the stats on each facet
sizewrapanno<- sizewrap +geom_text(data=sizepvalannodf, aes(x=3, y=4.1,label=pval),nudge_x = -.04,size=7,parse=TRUE)
# sizewrapanno


timingwrapanno <-timingwrap +geom_text(data=timingpvalannodf, aes(x=3, y=133,label=pval),nudge_x = -.04,size=7,parse=TRUE)
# timingwrapanno

viawrapanno <-viabilitywrap +geom_text(data=viapvalannodf, aes(x=3, y=110,label=pval),nudge_x = -.04,size=7,parse=TRUE)
# viawrapanno
```

```{r}
#annotate summary on facets MEAN
#pvaluessize #for structure

sumTMN["driver"]<-"TMN"
sumTII["driver"]<-"TII"
sumTN["driver"]<-"TN"
sumTD["driver"]<-"TD"
sumTR["driver"]<-"TR"
sumTM["driver"]<-"TM"
sumTL["driver"]<-"TL"
sumtabALLnew<-rbind(sumTMN,sumTII,sumTN,sumTD,sumTR,sumTL,sumTM)
#now has all measurements
sumtabALLnew$driver<-factor(sumtabALLnew$driver,c("TII","TR","TMN","TN","TD","TL","TM"))
write.csv(sumtabALLnew,"Dropbox/ActBeta_Rescues_sumtabALL.csv")

meananno<-function(x,y,z){
x<-sumtabALLnew #all data to pull annotations from
#y<-"size" #which measurement to subset from df of data
z<-"U" #which col of data to annotate with N/rep/mean=
df<-x
df<-subset(df,measurement==y) #subsets for one type of measurement
dfU<-df
dfU$measurement<-NULL #gets rid of measurement and date cols
dfU$date<-NULL

dfU<-subset(dfU,geno==z) #subsets U means
dfU$mean<-format(dfU$mean,digits=1,nsmall=1) #limits them to 2 decimal placess
Umean<-dfU$mean #vector now
Umean<-paste("M=",Umean,sep="") #puts mean= in front
#Umean<-apply(Umean,1,function(x)gsub('\\s+', '',x))
Umean<-gsub( " ", "", Umean) 

Umean #has mean=
dfU$mean<-Umean

df_mean<- df #makes second df with all means, cleans of certain cols
#df_mean$size<-NULL
df_mean$measurement<-NULL
df_mean$date<-NULL
df_mean<- subset(df_mean, geno!="U") #takes U data out of all sum
df_mean$mean<-format(df_mean$mean,digits=2,nsmall=1)#remaing means limited to 2 decimals

data_mean<-rbind(dfU,df_mean)
data_mean$driver<-as.factor(data_mean$driver)
#data_mean<-as.data.frame(apply(data_mean,2,function(x)gsub('\\s+', '',x)))#removes spaces from entire df
result<-data_mean
return(result)
}

meananno_1dec<-function(x,y,z){
x<-sumtabALLnew #all data to pull annotations from
#y<-"size" #which measurement to subset from df of data
z<-"U" #which col of data to annotate with N/rep/mean=
df<-x
df<-subset(df,measurement==y) #subsets for one type of measurement
dfU<-df
dfU$measurement<-NULL #gets rid of measurement and date cols
dfU$date<-NULL

dfU<-subset(dfU,geno==z) #subsets U means
dfU$mean<-format(dfU$mean,digits=1,nsmall=1) #limits them to 2 decimal placess
Umean<-dfU$mean #vector now
Umean<-paste("M=",Umean,sep="") #puts mean= in front
#Umean<-apply(Umean,1,function(x)gsub('\\s+', '',x))
Umean<-gsub( " ", "", Umean) 

Umean #has mean=
dfU$mean<-Umean

df_mean<- df #makes second df with all means, cleans of certain cols
#df_mean$size<-NULL
df_mean$measurement<-NULL
df_mean$date<-NULL
df_mean<- subset(df_mean, geno!="U") #takes U data out of all sum
df_mean$mean<-format(df_mean$mean,digits=1,nsmall=1)#remaing means limited to 2 decimals

data_mean<-rbind(dfU,df_mean)
data_mean$driver<-as.factor(data_mean$driver)
#data_mean<-as.data.frame(apply(data_mean,2,function(x)gsub('\\s+', '',x)))#removes spaces from entire df
result<-data_mean
return(result)
}

size_anno<-meananno(sumtabALLnew,"size","U")

sizewrapanno2 <- sizewrapanno +
  geom_text(data=size_anno, aes(x=geno,y=5.6, label= format(mean,digits=1,nsmall=2)),nudge_x = -.2,inherit.aes=FALSE,parse=FALSE)
# sizewrapanno2

timinganno<-meananno_1dec(sumtabALLnew,"timing")


#with just means in genos 1 #starts to reorder drivers
timingwrapanno2 <- timingwrapanno +geom_text(data=timinganno, aes(x=geno,y=150, label=mean), nudge_x = -.1,inherit.aes=FALSE,parse=FALSE)
#timingwrapanno2

#annotate viability wrap, has stats, add mean
viaanno<-meananno_1dec(sumtabALLnew,"viability","U")
viawrapanno2<- viawrapanno + geom_text(data=viaanno, aes(x=geno,y=165, label=mean),nudge_x = -.2,inherit.aes=FALSE,parse=FALSE)
#viawrapanno2

Rep_anno<-function(x,y,z){
x<-sumtabALLnew #all data to pull annotations from
#y<-"size" #which measurement to subset from df of data
z<-"U" #which col of data to annotate with N/rep/mean=
df<-x
df<-subset(df,measurement==y) #subsets for one type of measurement
dfU<-df
dfU$measurement<-NULL #gets rid of measurement and date cols
dfU$date<-NULL

dfU<-subset(dfU,geno==z) #subsets U means
dfU$mean<-format(dfU$mean,digits=2,nsmall=0) #limits them to 2 decimal placess
Umean<-dfU$N #vector now
Umean<-paste("R=",Umean,sep="") #puts mean= in front
Umean #has mean=
dfU$mean<-Umean

df_mean<- df #makes second df with all means, cleans of certain cols
#df_mean$size<-NULL
df_mean$measurement<-NULL
df_mean$date<-NULL
df_mean<- subset(df_mean, geno!="U") #takes U data out of all sum
df_mean$mean<-format(df_mean$N,digits=1,nsmall=0)#remaing means limited to 2 decimals

data_mean<-rbind(dfU,df_mean)
data_mean$driver<-as.factor(data_mean$driver)
result<-data_mean
return(result)
}

N_anno<-function(x,y,z){
x<-sumtabALLnew #all data to pull annotations from
#y<-"size" #which measurement to subset from df of data
z<-"U" #which col of data to annotate with N/rep/mean=
df<-x
df<-subset(df,measurement==y) #subsets for one type of measurement
dfU<-df
dfU$measurement<-NULL #gets rid of measurement and date cols
dfU$date<-NULL

dfU<-subset(dfU,geno==z) #subsets U means
dfU$mean<-format(dfU$mean,digits=2,nsmall=0) #limits them to 2 decimal placess
Umean<-dfU$N #vector now
Umean<-paste("N=",Umean,sep="") #puts mean= in front
Umean #has mean=
dfU$mean<-Umean

df_mean<- df #makes second df with all means, cleans of certain cols
#df_mean$size<-NULL
df_mean$measurement<-NULL
df_mean$date<-NULL
df_mean<- subset(df_mean, geno!="U") #takes U data out of all sum
df_mean$mean<-format(df_mean$N,digits=1,nsmall=0)#remaing means limited to 2 decimals

data_mean<-rbind(dfU,df_mean)
data_mean$driver<-as.factor(data_mean$driver)
result<-data_mean
return(result)
}

N_anno_1<-function(x){
x<-sumtabALLnew #all data to pull annotations from
#y<-"size" #which measurement to subset from df of data
#z<-"U" #which col of data to annotate with N/rep/mean=
df<-x
#df<-subset(df,measurement==y) #subsets for one type of measurement
dfU<-df
dfU$measurement<-NULL #gets rid of measurement and date cols
dfU$date<-NULL

#dfU<-subset(dfU,geno==z) #subsets U means
dfU$mean<-format(dfU$mean,digits=2,nsmall=0) #limits them to 2 decimal placess
Umean<-dfU$N #vector now
Umean<-paste("N=",Umean,sep="") #puts mean= in front
Umean #has mean=
dfU$mean<-Umean

df_mean<- df #makes second df with all means, cleans of certain cols
#df_mean$size<-NULL
df_mean$measurement<-NULL
df_mean$date<-NULL
df_mean<- subset(df_mean, geno!="U") #takes U data out of all sum
df_mean$mean<-format(df_mean$N,digits=1,nsmall=0)#remaing means limited to 2 decimals

data_mean<-rbind(dfU,df_mean)
data_mean$driver<-as.factor(data_mean$driver)
result<-data_mean
return(result)
}

viaRep<-Rep_anno(sumtabALLnew,"viability","U")
sizeN<-N_anno(sumtabALLnew,"size","N")
timingRep<-Rep_anno(sumtabALLnew,"timing","U")

viawrapanno3 <- viawrapanno2 +
  geom_text(data=viaRep, aes(x=geno,y=-25, label= format(mean,digits=1,nsmall=2)),nudge_x = -.3,inherit.aes=FALSE,parse=FALSE)
#viawrapanno3

timingwrapanno4 <- timingwrapanno2 + geom_text(data=timingRep, aes(x=geno,y=105, label= format(mean,digits=1,nsmall=2)),nudge_x = -.3,inherit.aes=FALSE,parse=FALSE)
#timingwrapanno4

sizewrapanno3 <- sizewrapanno2 +geom_text(data=sizeN, aes(x=geno,y=-0.5, label= format(mean,digits=1,nsmall=2)),nudge_x = -.2,inherit.aes=FALSE,parse=FALSE)
#sizewrapanno3
```

#ligand rescues: plot size and via FOR PAPER
```{r}
--#running panel of graphs
#use grid/viewport to print each graph in a column across a row
require(grid)
#move to a new page
grid.newpage()

#create layout: nrow=#, ncol=#
#doubling the number of columns changes nothing
pushViewport(viewport(layout = grid.layout(1,3)))

#a helper function to define a region on the layout
define_region<-function(row,col){
  viewport(layout.pos.row = row, layout.pos.col = col)
}

require(grid)
require(gridExtra)

fullplot <- grid.arrange( sizewrapanno3, viawrapanno3, ncol=2, nrow=1)

#arrange the plots
pdf(file = "Ligand Rescue.pdf", height=30, width=11, title="Rescues") #11 by 11 for paper/thesis, 30 x 11 for presentation
plot(fullplot)
dev.off()

```

#activin phenotypes analysis
```{r}
#actPover80 phenotype characterizations
#load files
actP80sizedata<-read.csv("actP80size.csv")
colnames(actP80sizedata)[2]<-"geno"
colnames(actP80sizedata)[3]<-"genotypeother"#won't use this column
actP80sizedata$rep<-as.factor(actP80sizedata$rep)
actP80sizedata["experiment"]<-"actP80size"


act80viability<-read.csv("act80viability.csv")
act80viability<-readyviabililty(act80viability)
act80viability$geno<-factor(act80viability$geno,levels=c("W1118","HET","ACT"))
act80viability["experiment"]<-"act80viability"

actPhalfpoint<-read.csv("actPhalfpoint.csv") #remove for paper
#actPhalfpoint$geno<-factor(actPhalfpoint$geno,levels=c("W","AP")) #remove for paper
#actPhalfpoint["allele"]<-"P"
act80halfpoint<-read.csv("act80halfpoint.csv")
act80halfpoint$geno<-factor(act80halfpoint$geno,levels=c("W1118","HET","ACT"))
act80halfpoint["experiment"]<-"act80halfpoint"
act80halfpoint["measurement"]<-"halfpoint"
#act80halfpoint["allele"]<-"80"
colnames(actPhalfpoint)[3]<-"value"
#actPhalfpoint<-actPhalfpoint[,c(2,1,3,4,5)]
actPhalfpoint$rep<-as.factor(actPhalfpoint$rep)
#actP80halfpoint<-rbind(act80halfpoint,actPhalfpoint)
actPhalfpoint["experiment"]<-"actPhalfpoint"
actPhalfpoint["measurement"]<-"halfpoint"

actP80size<-readysize(actP80sizedata)
actP80size<-na.omit(actP80size)
actP80size$geno[actP80size$geno==1]<-c("w1118")
actP80size$geno[actP80size$geno==2]<-c("Act80/80")
actP80size$geno[actP80size$geno==3]<-c("ActP/P")
actP80size$geno[actP80size$geno==4]<-c("Act80/P")
actP80size$geno[actP80size$geno==5]<-c("Act80/+")
actP80size$geno[actP80size$geno==6]<-c("ActP/+")
actP80size$geno<-factor(actP80size$geno,levels=c("w1118","Act80/+","Act80/80","ActP/+","ActP/P","Act80/P")) #set as factor,reorder factors
actP80size["experiment"]<-"actP80size"

W<-subset(actP80size, geno=="w1118")
het<-subset(actP80size, geno=="Act80/+")
ho<-subset(actP80size, geno=="Act80/80")

actP80size<-rbind(W, het, ho)
actP80size$geno <- factor(actP80size$geno)

actP80length<-readysizeL(actP80sizedata)
actP80length<-na.omit(actP80length)
actP80length$geno[actP80length$geno==1]<-c("w1118")
actP80length$geno[actP80length$geno==2]<-c("Act80/80")
actP80length$geno[actP80length$geno==3]<-c("ActP/P")
actP80length$geno[actP80length$geno==4]<-c("Act80/P")
actP80length$geno[actP80length$geno==5]<-c("Act80/+")
actP80length$geno[actP80length$geno==6]<-c("ActP/+")
actP80length$geno<-factor(actP80length$geno,levels=c("w1118","Act80/+","Act80/80","ActP/+","ActP/P","Act80/P")) #set as factor,reorder factors
actP80length["experiment"]<-"actP80length"

actP80width<-readysizeW(actP80sizedata)
actP80width<-na.omit(actP80width)
actP80width$geno[actP80width$geno==1]<-c("w1118")
actP80width$geno[actP80width$geno==2]<-c("Act80/80")
actP80width$geno[actP80width$geno==3]<-c("ActP/P")
actP80width$geno[actP80width$geno==4]<-c("Act80/P")
actP80width$geno[actP80width$geno==5]<-c("Act80/+")
actP80width$geno[actP80width$geno==6]<-c("ActP/+")
actP80width$geno<-factor(actP80width$geno,levels=c("w1118","Act80/+","Act80/80","ActP/+","ActP/P","Act80/P")) #set as factor,reorder factors
actP80width["experiment"]<-"actP80width"

crisprtime<-read.csv("crisprhalfpoint.csv")
crisprtime$rep<-as.factor(crisprtime$rep)
crisprtime$geno<-factor(crisprtime$geno,levels=c("w1118","CC","80","4E","10E","80/4","10/80","10/4"))
crisprtimeALL<-crisprtime
crisprtime<-subset(crisprtime, geno=="w1118" | geno=="80/4" | geno=="10/80"  | geno=="10/4")
crisprtimeALL["experiment"]<-"crisprtimeALL"
crisprtimeALL["measurement"]<-"halfpoint"

crisprviability<-read.csv("crisprviability.csv")
crisprviability<-readyviabililty(crisprviability)
crisprviability$rep<-as.factor(crisprviability$rep)
crisprviability$geno<-factor(crisprviability$geno,levels=c("W","CC","80","4","10","80/4","10/80","4/10"))
crisprviabilityALL<-crisprviability
levels(crisprviability$geno)
crisprviability<-subset(crisprviability, geno=="W" | geno=="80/4" | geno=="10/80"  | geno=="4/10")
crisprviability$geno<-factor(crisprviability$geno)
levels(crisprviability$geno)
crisprviabilityALL["experiment"]<-"crisprviabilityALL"

crisprsize<-read.csv("CRISPR size 80 10 4.csv")
crisprsize<-readysize(crisprsize)
crisprsize$rep<-as.factor(crisprsize$rep)
crisprsize$geno<-as.character(crisprsize$geno)
crisprsize$geno<-as.factor(crisprsize$geno)
crisprsize$geno<-factor(crisprsize$geno,levels=c("W1118","CC","80","4","10","80/4","10/80","10/4"))
crisprsizeALL<-crisprsize
crisprsize<-subset(crisprsize, geno=="W1118" | geno=="80/4" | geno=="10/80"  | geno=="10/4")
crisprsizeALL["experiment"]<-"crisprsizeALL"

actPhenoALL<-rbind(crisprsizeALL,actP80size,act80viability,actPhalfpoint,crisprtimeALL,act80halfpoint,crisprviabilityALL) #add crisprviability later
actPhenoALLsummary<-ddply(actPhenoALL,.(experiment, measurement),sumFun)
write.csv(actPhenoALLsummary,file="actPhenoALLsummary.csv")

actPhenoALLstat<-ddply(actPhenoALL,.(experiment, measurement),statFun)
write.csv(actPhenoALLstat,file="actPhenoALLstat.csv")
```

```{r}
sum<-subset(actPhenoALLsummary,experiment=="actP80size")
(sum[1,5]-sum[3,5])/sum[1,5]*100 #-21.26% pupal size change act80

sum<-subset(actPhenoALLsummary,experiment=="crisprsizeALL")
(sum[1,5]-sum[6,5])/sum[1,5]*100 #-21.10% pupal size change 80/4
(sum[1,5]-sum[7,5])/sum[1,5]*100 #-22.40% pupal size change 10/80
(sum[1,5]-sum[8,5])/sum[1,5]*100 #-25.81% pupal size change 10/4

sum<-subset(actPhenoALLsummary,experiment=="act80halfpoint")
(sum[1,5]-sum[2,5]) #4.2 hours 80/+
(sum[1,5]-sum[3,5]) #3.4 hours 80/80

sum<-subset(actPhenoALLsummary,experiment=="crisprtimeALL")
(sum[6,5]-sum[3,5]) #10.3 hours  80/4
(sum[6,5]-sum[4,5]) #10.3 hours 10/80
(sum[6,5]-sum[5,5]) #9.9  hours 10/4 

```

##activin phenotype graph and annotate
```{r}
sum<-subset(actPhenoALLsummary,experiment=="actP80size")
#index y-limits and other parameters
ysp<-4.1
ysm<-5.15
ysn<--0.5

#index annotation size for different graphs/annotations
asm<-6
asp<-6
asn<-6

atp<-6
atm<-5
atn<-6

avp<-6
avm<-6
avn<-6


yvp<-100
yvm<-140
yvn<- -25
#for act phenotypes
justfirstone<-plasma(5,alpha=1,begin=.85,end=.15) # act80P final colors for first color
actcolors<-plasma(5,alpha=1,begin=.9,end=.15) #for rest of colors


colormaster[1]="gray60"
actP80sizecolors<-c("gray60",justfirstone[1], actcolors[2:5]) #has 6 colors
#actP80sizecolors<-c(colormaster[1],colormaster[2],colormaster[3],colormaster[4],colormaster[5],colormaster[6])

act80colors<-c("gray60",actP80sizecolors[2:3]   )
actPcolors<-c("gray60",actP80sizecolors[4:5]   )
actandwcolor<-c("gray60",actP80sizecolors[3])
actandwshapes<-c(22,24)

actP80sizecolors<-actP80sizecolors[1:3]
actP80sizeshapes<-actP80sizeshapes[1:3]

actP80sizeplot<-basePlot(actP80size, 1.5) #baseplot

actP80sizeplot<-restofPlot(actP80sizeplot,3,legendposition = "none",colorset=actP80sizecolors,shapesset=actP80sizeshapes,errorbarwidth =0.9,errorbarsize = 0.2)+scale_y_continuous(limits=slim,breaks=sbr,labels=slab)+theme(panel.grid.minor.y=element_blank())#finishing touch
actP80sizeplot


actP80sizeplotanno<-actP80sizeplot+
   annotate("text", label = paste("N=", sum[1,4]), x = 1, y = ysn, size =asn, colour = "black")+
   annotate("text", label = sum[2,4], x = 2, y = ysn, size = asn, colour = "black")+
   annotate("text", label = sum[3,4], x = 3, y = ysn, size = asn, colour = "black")+
  annotate("text", label = paste("M=",format( sum[1,5],digits=1,nsmall=2)), x = 1, y = ysm, size =asm, colour = "black")+
   annotate("text", label = format(sum[2,5],digits=1,nsmall=2), x = 2, y = ysm, size = asm, colour = "black")+
   annotate("text", label = format(sum[3,5],digits=1,nsmall=2), x = 3, y = ysm, size = asm, colour = "black")+
   annotate("text", label = "ns", x = 2, y = ysp, size = asp, colour = "black")+
   annotate("text", label = "****", x = 3, y = ysp, size = asp, colour = "black")+
  theme(legend.title = element_blank())
# actP80sizeplotanno

 act80viabilityplot<-basePlot(act80viability,5,jitterwidth = .5)
 act80viabilityplotlegend<-restofPlot(act80viabilityplot,5,legendposition = "bottom",colorset=act80colors,timing80shapes,errorbarwidth =0.9,errorbarsize = 0.2)+scale_y_continuous(limits=vlim,breaks=vbr,labels=vlab)+theme(panel.grid.minor.y=element_blank())
 act80viabilityplot<-restofPlot(act80viabilityplot,5,legendposition = "none",colorset=act80colors,timing80shapes,errorbarwidth =0.9,errorbarsize = 0.2)+scale_y_continuous(limits=vlim,breaks=vbr,labels=vlab)+theme(panel.grid.minor.y=element_blank())

 sum<-subset(actPhenoALLsummary,experiment=="act80viability")

act80viabilityplotanno<-act80viabilityplot+
   annotate("text", label = paste("R=", sum[1,4]), x = 1, y = yvn, size =avn, colour = "black")+
   annotate("text", label = sum[2,4], x = 2, y = yvn, size = avn, colour = "black")+
   annotate("text", label = sum[3,4], x = 3, y = yvn, size = avn, colour = "black")+
  annotate("text", label = paste("M=",format(sum[1,5],digits=1,nsmall=1)), x = 1, y = yvm, size =avm, colour = "black")+
   annotate("text", label = format(sum[2,5],digits=1,nsmall=1), x = 2, y = yvm, size = avm, colour = "black")+
   annotate("text", label = format(sum[3,5],digits=1,nsmall=1), x = 3, y = yvm, size = avm, colour = "black")+
  annotate("text", label = "ns", x = 2, y = yvp, size = atp, colour = "black")+
   annotate("text", label = "****", x = 3, y = yvp, size = atp, colour = "black")+theme(legend.title = element_blank())
# act80viabilityplotanno
 
timingplot80<-basePlot(act80halfpoint,4,0.4) 
timingplot80legend<-restofPlot(timingplot80,4,act80colors,timing80shapes,legendposition="bottom",errorbarwidth =0.9,errorbarsize = 0.2) +scale_y_continuous(limits=tlim,breaks=tbr,labels=tlab)+theme(panel.grid.minor.y=element_blank())
timingplot80<-restofPlot(timingplot80,4,act80colors,timing80shapes,legendposition="none",errorbarwidth =0.9,errorbarsize = 0.2) +scale_y_continuous(limits=tlim,breaks=tbr,labels=tlab)+theme(panel.grid.minor.y=element_blank())

  ytp<-133
ytm<-145
ytn<-105
 sum<-subset(actPhenoALLsummary,experiment=="act80halfpoint")

timingplot80anno<-timingplot80+
   annotate("text", label = paste("R=", sum[1,4]), x = 1, y = ytn, size =atn, colour = "black")+
   annotate("text", label = sum[2,4], x = 2, y = ytn, size = atn, colour = "black")+
   annotate("text", label = sum[3,4], x = 3, y = ytn, size = atn, colour = "black")+
  annotate("text", label = paste("M=",format(sum[1,5],digits=1,nsmall=1)), x = 1, y = ytm, size =atm, colour = "black")+
   annotate("text", label = format(sum[2,5],digits=1,nsmall=1), x = 2, y = ytm, size = atm, colour = "black")+
   annotate("text", label = format(sum[3,5],digits=1,nsmall=1), x = 3, y = ytm, size = atm, colour = "black")+
   annotate("text", label = "****", x = 2, y = ytp, size = atp, colour = "black")+
   annotate("text", label = "***", x = 3, y = ytp, size = atp, colour = "black")+theme(legend.title = element_blank())
# timingplot80anno

timingplotP<-basePlot(actPhalfpoint,4,0.5) 
timingplotPlegend<-restofPlot(timingplotP,4,actPcolors,timingPshapes,legendposition="bottom",errorbarwidth =0.9,errorbarsize = 0.2) +scale_y_continuous(limits=tlim,breaks=tbr,labels=tlab)+theme(panel.grid.minor.y=element_blank())
timingplotP<-restofPlot(timingplotP,4,actPcolors,timingPshapes,legendposition="none",errorbarwidth =0.9,errorbarsize = 0.2) +scale_y_continuous(limits=tlim,breaks=tbr,labels=tlab)+theme(panel.grid.minor.y=element_blank())

 ytp<-133
ytm<-145
ytn<-105
 sum<-subset(actPhenoALLsummary,experiment=="actPhalfpoint")

timingplotPanno<-timingplotP+
   annotate("text", label = paste("R=", sum[1,4]), x = 1, y = ytn, size =atn, colour = "black")+
   annotate("text", label = sum[2,4], x = 2, y = ytn, size = atn, colour = "black")+
  annotate("text", label = paste("M=",format(sum[1,5],digits=1,nsmall=1)), x = 1, y = ytm, size =atm, colour = "black")+
   annotate("text", label = format(sum[2,5],digits=1,nsmall=1), x = 2, y = ytm, size = atm, colour = "black")+
   annotate("text", label = "****", x = 2, y = ytp, size = atp, colour = "black")+
   theme(legend.title = element_blank())
# timingplotPanno

crisprcol<-viridis(3,alpha=1,begin=.9,end=.2) # act crispr final colors

colormaster[1]="gray60"
crisprcolors<-c("gray60",crisprcol) #has 6 colors

crisprsizeplotbase<-basePlot(crisprsize,1.9) #baseplot
crisprsizeplotlegend<-restofPlot(crisprsizeplotbase,3,legendposition = "bottom",crisprcolors,crisprshapes)+scale_y_continuous(limits=slim,breaks=sbr,labels=slab)+theme(panel.grid.minor.y=element_blank())#finishing touch
crisprsizeplot<-restofPlot(crisprsizeplotbase,3,legendposition = "none",crisprcolors,crisprshapes,errorbarwidth =0.9,errorbarsize = 0.2)+scale_y_continuous(limits=slim,breaks=sbr,labels=slab)+theme(panel.grid.minor.y=element_blank())#finishing touch
# crisprsizeplot

sum<-subset(actPhenoALLsummary,experiment=="crisprsizeALL")
levels(sum$geno)
str(sum)
sum<-subset(sum,geno=="W1118" |geno== "80/4" | geno=="10/80" | geno=="10/4")

crisprsizeplotanno<-crisprsizeplot+
   annotate("text", label = paste("N=", sum[1,4]), x = 1, y = ysn, size =asn, colour = "black")+
   annotate("text", label = sum[2,4], x = 2, y = ysn, size = asn, colour = "black")+
   annotate("text", label = sum[3,4], x = 3, y = ysn, size = asn, colour = "black")+
  annotate("text", label = sum[4,4], x = 4, y = ysn, size = asn, colour = "black") +
  annotate("text", label = paste("M=",format( sum[1,5],digits=1,nsmall=2)), x = 1, y = ysm, size =asm, colour = "black")+
   annotate("text", label = format(sum[2,5],digits=1,nsmall=2), x = 2, y = ysm, size = asm, colour = "black")+
   annotate("text", label = format(sum[3,5],digits=1,nsmall=2), x = 3, y = ysm, size = asm, colour = "black")+
    annotate("text", label = format(sum[4,5],digits=1,nsmall=2), x = 4, y = ysm, size = asm, colour = "black")+
   annotate("text", label = "****", x = 2, y = ysp, size = asp, colour = "black")+
   annotate("text", label = "****", x = 3, y = ysp, size = asp, colour = "black")+
   annotate("text", label = "***", x = 4, y = ysp, size = asp, colour = "black")+theme(legend.title = element_blank())
# crisprsizeplotanno

cristimeplot<-basePlot(crisprtime,4,0.5)
cristimeplotlegend<-restofPlot(cristimeplot,4,crisprcolors,crisprshapes,legendposition="bottom",errorbarwidth =0.9,errorbarsize = 0.2) +scale_y_continuous(limits=tlim,breaks=tbr,labels=tlab)+theme(panel.grid.minor.y=element_blank())
cristimeplot<-restofPlot(cristimeplot,4,crisprcolors,crisprshapes,legendposition="none",errorbarwidth =0.9,errorbarsize = 0.2) +scale_y_continuous(limits=tlim,breaks=tbr,labels=tlab)+theme(panel.grid.minor.y=element_blank())

sum<-subset(actPhenoALLsummary,experiment=="crisprtimeALL")
levels(sum$geno)
str(sum)
sum<-subset(sum,geno=="w1118" |geno== "80/4" | geno=="10/80" | geno=="10/4")
target<-c("w1118" , "80/4" ,"10/80" ,"10/4")
sum<-sum[match(target, sum$geno),]
#sum$geno<-factor(sum$geno,levels=c("w1118" , "80/4" ,"10/80" ,"10/4")) relevel doesn't change order of rows?

#here
cristimeplotanno<-cristimeplot+
   annotate("text", label = paste("R=", sum[1,4]), x = 1, y = ytn, size =atn, colour = "black")+
   annotate("text", label = sum[2,4], x = 2, y = ytn, size = atn, colour = "black")+
   annotate("text", label = sum[3,4], x = 3, y = ytn, size = atn, colour = "black")+
  annotate("text", label = sum[4,4], x = 4, y = ytn, size = atn, colour = "black") +
  annotate("text", label = paste("M=",format( sum[1,5],digits=1,nsmall=1)), x = 1, y = ytm, size =atm, colour = "black")+
   annotate("text", label = format(sum[2,5],digits=1,nsmall=1), x = 2, y = ytm, size = atm, colour = "black")+
   annotate("text", label = format(sum[3,5],digits=1,nsmall=1), x = 3, y = ytm, size = atm, colour = "black")+
    annotate("text", label = format(sum[4,5],digits=1,nsmall=1), x = 4, y = ytm, size = atm, colour = "black")+
   annotate("text", label = "****", x = 2, y = ytp, size = atp, colour = "black")+
   annotate("text", label = "****", x = 3, y = ytp, size = atp, colour = "black")+
   annotate("text", label = "****", x = 4, y = ytp, size = atp, colour = "black")+theme(legend.title = element_blank())
# cristimeplotanno

crisprviabilityplot<-basePlot(crisprviability,5,jitterwidth = .5)
crisprviabilityplotlegend<-restofPlot(crisprviabilityplot,5,legendposition = "bottom",colorset=crisprcolors,shapesset=crisprshapes,errorbarwidth =0.9,errorbarsize = 0.2)+scale_y_continuous(limits=vlim,breaks=vbr,labels=vlab)+theme(panel.grid.minor.y=element_blank())
crisprviabilityplot<-restofPlot(crisprviabilityplot,5,legendposition = "none",colorset=crisprcolors,shapesset=crisprshapes,errorbarwidth =0.9,errorbarsize = 0.2)+scale_y_continuous(limits=vlim,breaks=vbr,labels=vlab)+theme(panel.grid.minor.y=element_blank())

#crisprviability
sum<-subset(actPhenoALLsummary,experiment=="crisprviabilityALL")
actPhenoALLsummary$experiment<-as.factor(actPhenoALLsummary$experiment)
#levels(actPhenoALLsummary$experiment)
str(sum)
sum<-subset(sum,geno=="W" |geno== "80/4" | geno=="10/80" | geno=="4/10")

crisprviabilityplotanno<-crisprviabilityplot+
   annotate("text", label = paste("R=", sum[1,4]), x = 1, y = yvn, size =avm, colour = "black")+
   annotate("text", label = sum[2,4], x = 2, y = yvn, size = avm, colour = "black")+
   annotate("text", label = sum[3,4], x = 3, y = yvn, size = avm, colour = "black")+
  annotate("text", label = sum[4,4], x = 4, y = yvn, size = avm, colour = "black") +
  annotate("text", label = paste("M=",format(sum[1,5],digits=1,nsmall=1)), x = 1, y = yvm, size =avm, colour = "black")+
   annotate("text", label = format(sum[2,5],digits=1,nsmall=1), x = 2, y = yvm, size = avm, colour = "black")+
   annotate("text", label = format(sum[3,5],digits=1,nsmall=1), x = 3, y = yvm, size = avm, colour = "black")+
    annotate("text", label = format(sum[4,5],digits=1,nsmall=1), x = 4, y = yvm, size = avm, colour = "black")+
   annotate("text", label = "****", x = 2, y = yvp, size = avp, colour = "black")+
   annotate("text", label = "****", x = 3, y = yvp, size = avp, colour = "black")+
   annotate("text", label = "****", x = 4, y = yvp, size = avp, colour = "black")+theme(legend.title = element_blank())
# crisprviabilityplotanno
```

```{r}
# plot in grid
newdestination<-"Fig1 revised.pdf"
newtitle<-"actPhenoplotGRID" #trbl #need to take out the same margins from other graphs
plot1<-actP80sizeplotanno+theme(plot.margin =      margin(0.5, 0.0,  0., 0.0, "cm")) #left graph #left margin can be 2.25 but that eats into graph space
plot2<-crisprsizeplotanno+theme(plot.margin =      margin(0.5, 0,  0., 0.0, "cm"))
plot5<-act80viabilityplotanno+theme(plot.margin =  margin(0.0, 0.0, 0.5, 0.0, "cm")) #left graph
plot6<-crisprviabilityplotanno+theme(plot.margin = margin(0.0, 0, 0.5, 0.0, "cm"))

#print plots together
grid.newpage() #move to a new page
pushViewport(viewport(layout = grid.layout(3,4)))#create layout: nrow=#, ncol=#
#a helper function to define a region on the layout
define_region<-function(row,col){
  viewport(layout.pos.row = row, layout.pos.col = col)
}
layout<-rbind(c(1,1,2,2),
          
              c(5,5,6,6)
              )
test<-grid.arrange(plot1,plot2,plot5,plot6, layout_matrix=layout)
pdf(file =newdestination , height=15, width=12, title=newtitle)
plot(test)#change name to grid.arrange output
dev.off()  
```

```{r}
#analysis of activin-driven activin overexpression
data<-read.csv("Dropbox/act act size.csv")

#guts of driverdata fuction
#volume
dataV<-readysize(data)
dataV$rep<-as.factor(data$rep)
sumV<-sumgenONEsize(dataV)
sumV["measurement"]<-"volume"
statV<-statFunRep(dataV)
statV["measurement"]<-"dataV"

#length
dataL<-readysizeL(data)
dataL$rep<-as.factor(dataL$rep)
data_L_sum<-sumgenONElength(dataL)
data_L_sum["measurement"]<-"dataL"
data_L_stat<-statFunRep(dataL)
data_L_stat["measurement"]<-"dataL"

#width
dataW<-readysizeW(data)
dataW$rep<-as.factor(dataW$rep)
data_W_sum<-sumgenONEwidth(dataW)
data_W_sum["measurement"]<-"dataW"
data_W_stat<-statFunRep(dataW)
data_W_stat["measurement"]<-"dataW"

actactsumALL<-rbind(sumV,data_L_sum,data_W_sum)

actactstatsALL<-rbind(statV,data_L_stat,data_W_stat)

write.csv(actactsumALL,file = "Dropbox/act-act_size_summary.csv") #volume was increased, just use that data

write.csv(actactstatsALL,file = "Dropbox/act-act_size_stats.csv")

asn<-12
atn<-12
avn<-12

asm<-12
atm<-10
avm<-12

asp<-36
atp<-36
avp<-36
 
ysn<- -0.25
ysm<-3

slim<-c(-0.25,3)
sbr<-c(0,1,2,3)
slab<-c(0,1,2,3)
actactsizeV<-subset(dataV,measurement=="volume") #subsets just size data from all data
actactsizeV$geno<-factor(actactsizeV$geno,levels=c("act-gal/+","uas/+","act-act"))
actact_size_plot<-basePlot(actactsizeV,7)

actact_size_plot<-restofPlot(actact_size_plot,5,legendposition = "none",colorset=GAL4UAScol,shapesset=GAL4shapes,errorbarwidth =0.9,errorbarsize = 0.1)+scale_y_continuous(limits=slim,breaks=sbr,labels=slab)+theme(panel.grid.minor.y=element_blank())+ theme(strip.text.x = element_text(size = 8,colour="white"))+ theme(axis.text.y=element_text(size=40,colour = "grey62"))


actact_size_plot<-actact_size_plot+
   annotate("text", label = paste("N=", sumV[2,3]), x = 1, y = ysn, size =asn, colour = "black")+
   annotate("text", label = sumV[3,3], x = 2, y = ysn, size = asn, colour = "black")+
   annotate("text", label = sumV[1,3], x = 3, y = ysn, size = asn, colour = "black")+
  
  annotate("text", label = paste("M=",format( sumV[2,4],digits=1,nsmall=2)), x = 1, y = ysm, size =asm, colour = "black")+
   annotate("text", label = format(sumV[3,4],digits=1,nsmall=2), x = 2, y = ysm, size = asm, colour = "black")+
   annotate("text", label = format(sumV[1,4],digits=1,nsmall=2), x = 3, y = ysm, size = asm, colour = "black")+
  
   annotate("text", label = "*", x = 3, y = 2.9, size = asp, colour = "black")+theme(legend.title = element_blank())
# actact_size_plot
```

##act-act: timing, graph and annotate
```{r}
data<-read.csv("Dropbox/act-act timing.csv")
data<-readytiming(data)
data$geno<-factor(data$geno,levels=c("g/+","u/+", "a>a"))
stat<-statFunDate(data)
sum<-sumFun(data)

write.csv(sum,file = "Dropbox/act-act_timing_summary.csv") 

write.csv(stat,file = "Dropbox/act-act_timing_stats.csv")

ytmexception<-155
ytpexception<-148
ytnexception<-107
tbrexception<-c(tbr,150)
tlim<-c(107,155)


actacttimingplot<-basePlot(data,12) 
actacttimingplot<-restofPlot(actacttimingplot,6,legendposition = "none",colorset=GAL4UAScol,shapesset=GAL4shapes,errorbarwidth =0.9,errorbarsize = 0.2)+scale_y_continuous(limits=tlim,breaks=tbrexception,labels=tbrexception)+theme(panel.grid.minor.y=element_blank())+ theme(strip.text.x = element_text(size = 8,colour="white"))+ theme(axis.text.y=element_text(size=40,colour = "grey62"))

actacttimingplot<-actacttimingplot+
   annotate("text", label = paste("R=", sum[1,4]), x = 1, y = ytnexception, size =atn, colour = "black")+
   annotate("text", label = sum[2,4], x = 2, y = ytnexception, size = atn, colour = "black")+
   annotate("text", label = sum[3,4], x = 3, y = ytnexception, size = atn, colour = "black")+

  
  annotate("text", label = paste("M=",format(sum[1,3],digits=1,nsmall=1)), x = 1, y = ytmexception, size =atm, colour = "black")+
   annotate("text", label = format(sum[2,3],digits=1,nsmall=1), x = 2, y = ytmexception, size = atm, colour = "black")+
   annotate("text", label = format(sum[3,3],digits=1,nsmall=1), x = 3, y = ytmexception, size = atm, colour = "black")+
   
    
   annotate("text", label = "**", x = 3, y = ytpexception, size = atp, colour = "black")+theme(legend.title = element_blank())
 #actacttimingplot
```

##act-act: viability 
```{r}
data<-read.csv("Dropbox/act-act viability.csv")
data$geno<-factor(data$geno,levels=c("act-gal4/+","uas-act/+", "act>act"))
data<-readyviabililty(data)
stat<-statFun(data)
sum<-sumFun(data)

write.csv(sum,file = "Dropbox/act-act_viability_summary.csv")

write.csv(stat,file = "Dropbox/act-act_viability_stats.csv")

vlim<-c(-5,115)
yvm<-115
actact_viability_plot<-basePlot(data,12) 
actact_viability_plot<-restofPlot(actact_viability_plot,6,legendposition = "none",colorset=GAL4UAScol,shapesset=GAL4shapes,errorbarwidth =0.9,errorbarsize = 0.2)+scale_y_continuous(limits=vlim,breaks=vbr,labels=vlab)+ theme(axis.text.y=element_text(size=12,colour = "grey62"))+theme(panel.grid.minor.y=element_blank())+ theme(strip.text.x = element_text(size = 8,colour="white"))+ theme(axis.text.y=element_text(size=40,colour = "grey62"))

yvn<-c(-5)

actact_viability_plot<-actact_viability_plot+
   annotate("text", label = paste("R=",sum[1,4]), x = 1, y = yvn, size =avn, colour = "black")+
   annotate("text", label = sum[2,4], x = 2, y = yvn, size = avn, colour = "black")+
   annotate("text", label = sum[3,4], x = 3, y = yvn, size = avn, colour = "black")+

  
  annotate("text", label = paste("M=",format(sum[1,3],digits=1,nsmall=0)), x = 1, y = yvm, size =avm, colour = "black")+
   annotate("text", label = format(sum[2,3],digits=1,nsmall=0), x = 2, y = yvm, size = avm, colour = "black")+
   annotate("text", label = format(sum[3,3],digits=1,nsmall=0), x = 3, y = yvm, size = avm, colour = "black")+
   
   annotate("text", label = "ns", x = 3, y = yvp+5, size = 18, colour = "black")+theme(legend.title = element_blank())
 #actact_viability_plot
```

#act-act: export graph with MARGINS
```{r}
newdestination<-"Dropbox/Activin Paper I/Activin Phenotype Paper/act-act three phenos margin.pdf"
newtitle<-"act-act three phenos margin" #trbl #need to take out the same margins from other graphs
plot1<-actact_size_plot+theme(plot.margin =      margin(0.250, 1.5, 0.0, 1.5, "cm")) #left graph #left margin can be 2.25 but that eats into graph space
plot2<-actacttimingplot+theme(plot.margin =      margin(0.250, 1.5, 0.0, 1.5, "cm"))

plot3<-actact_viability_plot+theme(plot.margin = margin(0.250, 1.5, 0., 1.5, "cm"))  #left graph
# plot4<-timingplotPanno+theme(plot.margin =         margin(0.0, 0.0, 0.5, 0.0, "cm"))
# plot5<-cristimeplotanno+theme(plot.margin =        margin(0.0, 1.5, 0.5, 0.0, "cm"))
# 
# plot6<-act80viabilityplotanno+theme(plot.margin =  margin(0.0, 0.0, 5.0, 0.0, "cm")) #left graph
# plot7<-crisprviabilityplotanno+theme(plot.margin = margin(0.0, 1.5, 5.0, 0.0, "cm"))

#print plots together
grid.newpage() #move to a new page
pushViewport(viewport(layout = grid.layout(1,3)))#create layout: nrow=#, ncol=#
#a helper function to define a region on the layout
define_region<-function(row,col){
  viewport(layout.pos.row = row, layout.pos.col = col)
}
layout<-rbind(c(1,2,3)
              )
test<-grid.arrange(plot1,plot2, plot3, layout_matrix=layout)
pdf(file =newdestination , height=14, width=20, title=newtitle)
plot(test)#change name to grid.arrange output
dev.off() 
```

#ligand and muscle mapping: tissue-specific RNAi for activin beta
##elav,dicer>actBi
```{r}
asp<-30
#elav,dicer>actBi volume
data<- read.csv("Dropbox/Activin R Files/elav dicer actBi trip.csv")
data <- readysize(data)

# factor(data$geno)
data$geno<-factor(data$geno,levels=c("elavdicer/+","actBi/+","elavdicer>actBi"))
#levels(data$geno) #check are they in the right order?

sum<-sumFun(data)
write.csv(sum,"Dropbox/sum_edBi_tester.csv")
bartlett.test(data$value~data$geno)#p-value = 0.6079
stat<-statFun(data)
write.csv(stat,"Dropbox/stat_edBi.csv")

edbi_size_plot<-basePlot(data,4)
edbi_size_plot<-restofPlot(edbi_size_plot,5,legendposition = "bottom",colorset=GAL4UAScol,shapesset=GAL4shapes,errorbarwidth =0.9,errorbarsize = 0.1)+scale_y_continuous(limits=slim,breaks=sbr,labels=slab)+theme(panel.grid.minor.y=element_blank())+ theme(strip.text.x = element_text(size = 8,colour="white"))+ theme(axis.text.y=element_text(size=40,colour = "grey62"))
edbi_size_plot<-edbi_size_plot+
   annotate("text", label = paste("N=", sum[1,2]), x = 1, y = ysn, size =asn, colour = "black")+
   annotate("text", label = sum[2,2], x = 2, y = ysn, size = asn, colour = "black")+
   annotate("text", label = sum[3,2], x = 3, y = ysn, size = asn, colour = "black")+
  annotate("text", label = paste("M=",format( sum[1,3],digits=1,nsmall=2)), x = 1, y = ysm, size =asm, colour = "black")+
   annotate("text", label = format(sum[2,3],digits=1,nsmall=2), x = 2, y = ysm, size = asm, colour = "black")+
   annotate("text", label = format(sum[3,3],digits=1,nsmall=2), x = 3, y = ysm, size = asm, colour = "black")+
   annotate("text", label = "*", x = 3, y = 3.5, size = asp, colour = "black")+theme(legend.title = element_blank())
edbi_size_plot
```


##OK372,dicer>actBi
```{r}
#set all lims
asp<-30
sbr<- c (0 ,1, 2,3,4)
slab<- c (0 ,1, 2,3,4)
slim<-c(-0.25 , 4.25)
ysn<--0.25
ysm<-3
asn<-12
asm<-12

#OK372,dicer>actBi volume ALL 
data<- read.csv("Dropbox/File requests/new actb RNAi formatting.csv")
ddply(data,c("sex","geno"), summarize,
  Rep=length(length),
      mean=mean(length,na.rm=T)
)
originaldata<-data #to be able to pull for later
head(data)
#View(data)
data <- readysize(data)

factor(data$geno)
data$geno<-factor(data$geno,levels=c("372-+","RNAi-+", "372-RNAi"))
#levels(data$geno) #are they in the right order?

#generate sum and stats
sum<-sumFun(data)
write.csv(sum,"Dropbox/File requests/sum_OK372Bi.csv")
bartlett.test(data$value~data$geno)#p-value = 0.5886 
stat<-statFun(data)
write.csv(stat,"Dropbox/File requests/stat_OK372Bi.csv")

#generate size plot for ALL
Ok372_size_plot<-basePlot(data,4)

Ok372_size_plot<-restofPlot(Ok372_size_plot,5,legendposition = "bottom",colorset=GAL4UAScol,shapesset=GAL4shapes,errorbarwidth =0.9,errorbarsize = 0.1)+scale_y_continuous(limits=slim,breaks=sbr,labels=slab)+theme(panel.grid.minor.y=element_blank())+ theme(strip.text.x = element_text(size = 8,colour="white"))+ theme(axis.text.y=element_text(size=40,colour = "grey62"))

#CHANGE ANNOTATIONS
Ok372_size_plot<-Ok372_size_plot+
   annotate("text", label = paste("N=",  sum[1,2]), x = 1, y = ysn, size =asn, colour = "black")+
   annotate("text", label = sum[2,2], x = 2, y = ysn, size = asn, colour = "black")+
   annotate("text", label = sum[3,2], x = 3, y = ysn, size = asn, colour = "black")+
  annotate("text", label = paste("M=",format( sum[1,3],digits=1,nsmall=2)), x = 1, y = ysm, size =asm, colour = "black")+
   annotate("text", label = format(sum[2,3],digits=1,nsmall=2), x = 2, y = ysm, size = asm, colour = "black")+
   annotate("text", label = format(sum[3,3],digits=1,nsmall=2), x = 3, y = ysm, size = asm, colour = "black")+
   annotate("text", label = "**", x = 3, y = 3.5, size = asp, colour = "black")+theme(legend.title = element_blank())
Ok372_size_plot

#DO AGAIN BY SEX

#males
maledata<-subset(originaldata, sex=="M")

data<-maledata
data <- readysize(data)

factor(data$geno)
data$geno<-factor(data$geno,levels=c("372-+","RNAi-+", "372-RNAi"))
levels(data$geno) #are they in the right order?

#generate sum and stats
sum<-sumFun(data)
write.csv(sum,"Dropbox/File requests/sum_OK372Bimale.csv")

stat<-statFun(data)
write.csv(stat,"Dropbox/File requests/stat_OK372Bimale.csv")

Ok372_size_plotM<-basePlot(data,4)
Ok372_size_plotM<-restofPlot(Ok372_size_plotM,5,legendposition = "bottom",colorset=GAL4UAScol,shapesset=GAL4shapes,errorbarwidth =0.9,errorbarsize = 0.1)+scale_y_continuous(limits=slim,breaks=sbr,labels=slab)+theme(panel.grid.minor.y=element_blank())+ theme(strip.text.x = element_text(size = 8,colour="white"))+ theme(axis.text.y=element_text(size=40,colour = "grey62"))

#ANNOTATIONS
Ok372_size_plotM<-Ok372_size_plotM+
   annotate("text", label = paste("N=",  sum[1,2]), x = 1, y = ysn, size =asn, colour = "black")+
   annotate("text", label = sum[2,2], x = 2, y = ysn, size = asn, colour = "black")+
   annotate("text", label = sum[3,2], x = 3, y = ysn, size = asn, colour = "black")+
  annotate("text", label = paste("M=",format( sum[1,3],digits=1,nsmall=2)), x = 1, y = ysm, size =asm, colour = "black")+
   annotate("text", label = format(sum[2,3],digits=1,nsmall=2), x = 2, y = ysm, size = asm, colour = "black")+
   annotate("text", label = format(sum[3,3],digits=1,nsmall=2), x = 3, y = ysm, size = asm, colour = "black")+
   annotate("text", label = "***", x = 3, y = 3.5, size = asp, colour = "black")+theme(legend.title = element_blank())
Ok372_size_plotM

#females
femaledata<-subset(originaldata, sex=="F")
data<-femaledata
data<-readysize(femaledata)
data$geno<-factor(data$geno,levels=c("372-+","RNAi-+", "372-RNAi"))
sum<-sumFun(data)
write.csv(sum,"Dropbox/file requests/sum_OK372BiFemale.csv")
bartlett.test(data$value~data$geno)#p-value = 
stat<-statFun(data)
write.csv(stat,"Dropbox/file requests/stat_OK372BiFemale.csv")

Ok372_size_plotF<-basePlot(data,4)

Ok372_size_plotF<-restofPlot(Ok372_size_plotF,5,legendposition = "bottom",colorset=GAL4UAScol,shapesset=GAL4shapes,errorbarwidth =0.9,errorbarsize = 0.1)+scale_y_continuous(limits=slim,breaks=sbr,labels=slab)+theme(panel.grid.minor.y=element_blank())+ theme(strip.text.x = element_text(size = 8,colour="white"))+ theme(axis.text.y=element_text(size=40,colour = "grey62"))

#CHANGE ANNOTATIONS
Ok372_size_plotF<-Ok372_size_plotF+
   annotate("text", label = paste("N=",  sum[1,2]), x = 1, y = ysn, size =asn, colour = "black")+
   annotate("text", label = sum[2,2], x = 2, y = ysn, size = asn, colour = "black")+
   annotate("text", label = sum[3,2], x = 3, y = ysn, size = asn, colour = "black")+
  
  annotate("text", label = paste("M=",format( sum[1,3],digits=1,nsmall=2)), x = 1, y = ysm, size =asm, colour = "black")+
   annotate("text", label = format(sum[2,3],digits=1,nsmall=2), x = 2, y = ysm, size = asm, colour = "black")+
   annotate("text", label = format(sum[3,3],digits=1,nsmall=2), x = 3, y = ysm, size = asm, colour = "black")+
  
   annotate("text", label = "**", x = 3, y = 3.5, size = asp, colour = "black")+theme(legend.title = element_blank())
Ok372_size_plotF

newdestination<-"Dropbox/ok372 dicer actBi.pdf"
newtitle<-"ok372 dicer actBi legend"

grid.newpage() #move to a new page
test<-grid.arrange(Ok372_size_plot)

pdf(file =newdestination, height=10, width=7, title=newtitle)
plot(test)#change name to grid.arrange output
dev.off()
```

##mhc>dicer,baboi volume
```{r}
#mhc>dicer,baboi volume
data<- read.csv("Dropbox/Activin R Files/MHCdicerbaboi.csv")
data <- readysize(data)

levels(data$geno) #the function tells you what genotypes are in the data

###first, use this function to put them in the right order
data$geno<-factor(data$geno,levels=c("C22","C19","C23"))
levels(data$geno) #are they in the right order?

###change names of genotypes
#levels(volumedata$geno)[levels(volumedata$geno)=="C#"] <- "actualname" # copy as needed, don't change
levels(data$geno)[levels(data$geno)=="C19"] <- "MHC>dicer/+" #example 
levels(data$geno)[levels(data$geno)=="C22"] <- "babo RNAi/+" #example 
levels(data$geno)[levels(data$geno)=="C23"] <- "MHC>dicer,babo RNAi/+" #example 
levels(data$geno)#make sure they're right

sum<-sumFun(data)
write.csv(sum,"Dropbox/sum mhc baboi volume.csv")

stat<-statFun(data)
write.csv(stat,"Dropbox/stat mhc baboi volume.csv")

# factor(data$geno)
# data$geno<-factor(data$geno,levels=c("dSmadi2/+","MHC>dicer","MHC>dicer,dSmad2i"))
#levels(data$geno) #are they in the right order?

babooni_size_plot<-basePlot(data,4)

babooni_size_plot<-restofPlot(babooni_size_plot,5,legendposition = "bottom",colorset=GAL4UAScol,shapesset=GAL4shapes,errorbarwidth =0.9,errorbarsize = 0.1)+scale_y_continuous(limits=slim,breaks=sbr,labels=slab)+theme(panel.grid.minor.y=element_blank())+ theme(strip.text.x = element_text(size = 8,colour="white"))+ theme(axis.text.y=element_text(size=40,colour = "grey62"))

babooni_size_plot<-babooni_size_plot+
   annotate("text", label = paste("N=", sum[1,2]), x = 1, y = ysn, size =asn, colour = "black")+
   annotate("text", label = sum[2,2], x = 2, y = ysn, size = asn, colour = "black")+
   annotate("text", label = sum[3,2], x = 3, y = ysn, size = asn, colour = "black")+
  
  annotate("text", label = paste("M=",format( sum[1,3],digits=1,nsmall=2)), x = 1, y = ysm, size =asm, colour = "black")+
   annotate("text", label = format(sum[2,3],digits=1,nsmall=2), x = 2, y = ysm, size = asm, colour = "black")+
   annotate("text", label = format(sum[3,3],digits=1,nsmall=2), x = 3, y = ysm, size = asm, colour = "black")+
  
   annotate("text", label = "****", x = 3, y = 3.5, size = asp, colour = "black")+theme(legend.title = element_blank())
babooni_size_plot
```

##mhc>dicer,smoxi volume
```{r}
#mhc>dicer,smoxi volume
data<- read.csv("Dropbox/Activin R Files/mhc smoxi volume.csv")
data <- readysize(data)

sum<-sumFun(data)
write.csv(sum,"Dropbox/sum mhc smoxi volume.csv")

stat<-statFun(data)
write.csv(stat,"Dropbox/stat mhc smoxi volume.csv")

# factor(data$geno)
data$geno<-factor(data$geno,levels=c("dSmadi2/+","MHC>dicer","MHC>dicer,dSmad2i"))
#levels(data$geno) #are they in the right order?

smoxi_size_plot<-basePlot(data,4)

smoxi_size_plot<-restofPlot(smoxi_size_plot,5,legendposition = "bottom",colorset=GAL4UAScol,shapesset=GAL4shapes,errorbarwidth =0.9,errorbarsize = 0.1)+scale_y_continuous(limits=slim,breaks=sbr,labels=slab)+theme(panel.grid.minor.y=element_blank())+ theme(strip.text.x = element_text(size = 8,colour="white"))+ theme(axis.text.y=element_text(size=40,colour = "grey62"))
smoxi_size_plot<-smoxi_size_plot+
   annotate("text", label = paste("N=", sum[1,2]), x = 1, y = ysn, size =asn, colour = "black")+
   annotate("text", label = sum[2,2], x = 2, y = ysn, size = asn, colour = "black")+
   annotate("text", label = sum[3,2], x = 3, y = ysn, size = asn, colour = "black")+
  annotate("text", label = paste("M=",format( sum[1,3],digits=1,nsmall=2)), x = 1, y = ysm, size =asm, colour = "black")+
   annotate("text", label = format(sum[2,3],digits=1,nsmall=2), x = 2, y = ysm, size = asm, colour = "black")+
   annotate("text", label = format(sum[3,3],digits=1,nsmall=2), x = 3, y = ysm, size = asm, colour = "black")+
   annotate("text", label = "****", x = 3, y = 3.5, size = asp, colour = "black")+theme(legend.title = element_blank())
smoxi_size_plot
```


#ligand/muscle mapping:export
```{r}
newdestination<-"ligand muscle mappingnew.pdf"
newtitle<-"ligand muscle mapping" #trbl #need to take out the same margins from other graphs
plot1<-edbi_size_plot+theme(plot.margin =      margin(0.250, 1.5, 0.0, 1.5, "cm")) #left graph #left margin can be 2.25 but that eats into graph space
plot2<-Ok372_size_plot+theme(plot.margin =      margin(0.250, 1.5, 0.0, 1.5, "cm"))

plot3<-babooni_size_plot+theme(plot.margin =      margin(0.250, 1.5, 0.0, 1.5, "cm"))

plot4<-smoxi_size_plot+theme(plot.margin = margin(0.250, 1.5, 0., 1.5, "cm"))  #left graph

#print plots together
grid.newpage() #move to a new page
pushViewport(viewport(layout = grid.layout(1,4)))#create layout: nrow=#, ncol=#
#a helper function to define a region on the layout
define_region<-function(row,col){
  viewport(layout.pos.row = row, layout.pos.col = col)
}
layout<-rbind(c(1,2,3,4)
              )
test<-grid.arrange(plot1,plot2, plot3,plot4, layout_matrix=layout)
pdf(file =newdestination , height=14, width=30, title=newtitle)
plot(test)#change name to grid.arrange output
dev.off() 
```

#muscle size: nuclei number
```{r}
data<-read.csv("Dropbox/activin muscle size2.csv")
#t.test(y~x) # where y is numeric and x is a binary factor

names(data)[names(data) == 'nucnumber'] <- 'value'
data$geno<-as.factor(data$geno)
data$geno<-factor(data$geno, levels=c("W","A")) #reorder factors
data <- data[!is.na(data$value),]
NROW(data)
data2<-data

VL4<-subset(data,VL=="VL4")
head(VL4)
t.test(VL4$value~VL4$geno) #ns

data<-VL4
sum<-sumFun(data)

(sum[1,3]-sum[2,3])/sum[2,3]*100 #6.6% percent change in VL4 nuclei number

# factor(data$geno)
data$geno<-factor(data$geno,levels=c("W","A"))
#levels(data$geno) #are they in the right order?

ytmexception<-16
ytpexception<-13
ytnexception<-1

atnexception<-14
atmexception<-14
atpexception<-15

#VL4

VL4plot<-basePlot(data,9) 
VL4plot<-restofPlot(VL4plot,8,legendposition = "none",colorset=actandwcolor,shapesset=actandwshapes,errorbarwidth =0.9,errorbarsize = 0.8)+scale_y_continuous(limits=c(0,17),breaks=c(0,5,10,15),labels=c(0,5,10,15))+theme(panel.grid.minor.y=element_blank())+ theme(axis.text.y=element_text(size=40,colour = "grey62"))

nuc_VL4plotanno<-VL4plot+
   annotate("text", label = paste("N=", sum[1,2]), x = 1, y = ytnexception, size =atnexception, colour = "black")+
  annotate("text", label = sum[2,2], x = 2, y = ytnexception, size = atnexception, colour = "black")+
  
  annotate("text", label = paste("M=",format(sum[1,3],digits=1,nsmall=1)), x = 1, y = ytmexception, size =atmexception, colour = "black")+
   annotate("text", label = format(sum[2,3],digits=1,nsmall=1), x = 2, y = ytmexception, size = atmexception, colour = "black")+
  
   annotate("text", label = "ns", x = 2, y = ytpexception, size = atpexception, colour = "black")+theme(legend.title = element_blank())+ theme(legend.text=element_text(size=50))

VL3<-subset(data2,VL=="VL3")
head(VL3)
t.test(VL3$value~VL3$geno) #ns
data<-VL3
sum<-sumFun(data)

(sum[1,3]-sum[2,3])/sum[2,3]*100 #3.4% percent change in VL4 nuclei number

#VL3
VL3<-subset(data2,VL=="VL3")
head(VL3) 
t.test(VL3$value~VL3$geno) #four stars

data<-VL3
sum<-sumFun(data)
(sum[1,3]-sum[2,3])/sum[2,3]*100 #32.24% percent change in VL3 area
# factor(data$geno)
data$geno<-factor(data$geno,levels=c("W","A"))
#levels(data$geno) #are they in the right order?

#VL3
ytmexception<-21
ytpexception<-18
ytnexception<-1

atnexception<-14
atmexception<-14
atpexception<-15

VL3plot<-basePlot(data,9) 
VL3plot<-restofPlot(VL3plot,8,legendposition = "none",colorset=actandwcolor,shapesset=actandwshapes,errorbarwidth =0.9,errorbarsize = 0.8)+scale_y_continuous(limits=c(0,22),breaks=c(0,5,10,15,20),labels=c(0,5,10,15,20))+theme(panel.grid.minor.y=element_blank())+ theme(axis.text.y=element_text(size=40,colour = "grey62"))

nuc_VL3plotanno<-VL3plot+
  annotate("text", label = paste("N=", sum[1,2]), x = 1, y = ytnexception, size =atnexception, colour = "black")+
 annotate("text", label = sum[2,2], x = 2, y = ytnexception, size = atnexception, colour = "black")+
  annotate("text", label = paste("M=",format(sum[1,3],digits=1,nsmall=1)), x = 1, y = ytmexception, size =atmexception, colour = "black")+
   annotate("text", label = format(sum[2,3],digits=1,nsmall=1), x = 2, y = ytmexception, size = atmexception, colour = "black")+
   annotate("text", label = "ns", x = 2, y = ytpexception, size = atpexception, colour = "black")+theme(legend.title = element_blank())+ theme(legend.text=element_text(size=50))
```


#muscle size export
```{r}
 newdestination<-"Dropbox/Activin Paper I/Activin Phenotype Paper/activin muscle size measurements.pdf"
newtitle<-"muscle size" #trbl #need to take out the same margins from other graphs
plot1<-fib_VL4plotanno+theme(plot.margin=      margin(1, 0,1, 0, "cm"))
plot2<-fib_VL3plotanno+theme(plot.margin=      margin(1, 0,1, 0, "cm"))
plot3<-nuc_VL4plotanno+theme(plot.margin=    margin(1, 0,1, 0, "cm"))
plot4<-nuc_VL3plotanno+theme(plot.margin=     margin(1, 0,1, 0, "cm"))
plot5<-narea_VL4plotanno+theme(plot.margin=     margin(1, 0,1, 0, "cm"))
plot6<-narea_VL3plotanno+theme(plot.margin=       margin(1, 0,1, 0, "cm"))

#print plots together
grid.newpage() #move to a new page
pushViewport(viewport(layout = grid.layout(3,2)))#create layout: nrow=#, ncol=#
#a helper function to define a region on the layout
define_region<-function(row,col){
  viewport(layout.pos.row = row, layout.pos.col = col)
}

layout<-rbind(c(1,2),
              c(3,4),
              c(5,6))
test<-grid.arrange(plot1,plot2,plot3,plot4,plot5,plot6,  layout_matrix=layout)
pdf(file =newdestination , height=60, width=20, title=newtitle) #for paper 30 by 20 #for ppt 20 for 20
plot(test)#change name to grid.arrange output
dev.off() 
```
